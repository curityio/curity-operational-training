<config xmlns="http://tail-f.com/ns/config/1.0">
  <profiles xmlns="https://curity.se/ns/conf/base">
    <profile>
      <id>authentication-service</id>
      <type xmlns:auth="https://curity.se/ns/conf/profile/authentication">auth:authentication-service</type>
      <settings>
        <authentication-service xmlns="https://curity.se/ns/conf/profile/authentication">
          <persisted-sso-session>true</persisted-sso-session>
          <authentication-actions>
            <authentication-action>
              <id>select_factor</id>
              <multi-factor-condition xmlns="https://curity.se/ns/ext-conf/multi-factor-condition">
                <disable-second-factor-subject-check>true</disable-second-factor-subject-check>
                <always>
                  <second-factor>
                    <id>employees</id>
                  </second-factor>
                </always>
              </multi-factor-condition>
            </authentication-action>
          </authentication-actions>
          <authenticators>
            <authenticator>
              <id>email</id>
              <description>Email authentication</description>
              <email>
                <account-manager>default-account-manager</account-manager>
              </email>
            </authenticator>
            <authenticator>
              <id>employees</id>
              <description>Sign in with the employee login policy </description>
              <oidc xmlns="https://curity.se/ns/conf/authenticators/oidc">
                <configuration-url>#{EMPLOYEE_IDP_OIDC_METADATA}</configuration-url>
                <client-id>#{EMPLOYEE_IDP_CLIENT_ID}</client-id>
                <client-secret>#{EMPLOYEE_IDP_CLIENT_SECRET}</client-secret>
                <scope>openid email</scope>
                <use-subject-for-login-hint>true</use-subject-for-login-hint>
                <prompt-login>if-requested-by-client</prompt-login>
              </oidc>
            </authenticator>
            <authenticator>
              <id>passkeys</id>
              <description>Sign in with a passkey</description>
              <required-authenticator-for-registration>email</required-authenticator-for-registration>
              <passkeys xmlns="https://curity.se/ns/conf/authenticators/passkeys">
                <allow-registration-during-login>true</allow-registration-during-login>
                <enable-discoverable-credentials>true</enable-discoverable-credentials>
                <account-manager>
                  <id>default-account-manager</id>
                </account-manager>
              </passkeys>
            </authenticator>
            <authenticator>
              <id>passwords</id>
              <description>Sign in with a password</description>
              <html-form xmlns="https://curity.se/ns/conf/authenticators/html-form">
                <account-manager>default-account-manager</account-manager>
                <credential-manager>default-credential-manager</credential-manager>
              </html-form>
            </authenticator>
            <authenticator>
              <id>username</id>
              <authentication-actions>
                <login>select_factor</login>
              </authentication-actions>
              <description>Identify the user</description>
              <username xmlns="https://curity.se/ns/ext-conf/username">
              </username>
            </authenticator>
          </authenticators>
          <protocols>
            <protocol>
              <id>default-simple-protocol</id>
              <simple-api/>
            </protocol>
          </protocols>
        </authentication-service>
      </settings>
      <endpoints>
        <endpoint>
          <id>authentication-service-anonymous</id>
          <uri>/authn/anonymous</uri>
          <endpoint-kind>auth-anonymous</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>authentication-service-authentication</id>
          <uri>/authn/authentication</uri>
          <endpoint-kind>auth-authentication</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>authentication-service-registration</id>
          <uri>/authn/registration</uri>
          <endpoint-kind>auth-registration</endpoint-kind>
        </endpoint>
      </endpoints>
      <token-issuers>
        <default-token-issuer>
          <jwt-issuer-settings>
            <algorithm>ES256</algorithm>
            <signing-key-id>default-signing-key</signing-key-id>
          </jwt-issuer-settings>
          <default-data-source>default-datasource</default-data-source>
        </default-token-issuer>
      </token-issuers>
    </profile>
  </profiles>
</config>