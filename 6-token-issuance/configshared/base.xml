<config xmlns="http://tail-f.com/ns/config/1.0">
  <environments xmlns="https://curity.se/ns/conf/base">
    <environment>
      <base-url>#{RUNTIME_BASE_URL}</base-url>
      <admin-service>
        <http>
        <base-url>#{ADMIN_BASE_URL}</base-url>
        <web-ui>
          <admin-federated-login>
            <using-oauth-profile xmlns="https://curity.se/ns/conf/profile/oauth">
              <http-client>internal_http_client</http-client>
              <oauth-profile>token-service</oauth-profile>
              <client>admin_ui_client</client>
            </using-oauth-profile>
          </admin-federated-login>
        </web-ui>
        <restconf>
          <oauth xmlns="https://curity.se/ns/conf/profile/oauth">
            <oauth-profile>token-service</oauth-profile>
            <client>devops_dashboard_restconf_client</client>
          </oauth>
        </restconf>
        <devops-dashboard xmlns="https://curity.se/ns/conf/profile/oauth">
          <authorization-manager>default</authorization-manager>
          <client>devops_dashboard_restconf_client</client>
        </devops-dashboard>
        </http>
      </admin-service>
      <services>
        <zones>
          <default-zone>
            <email-provider>smtp</email-provider>
            <symmetric-key>#{SYMMETRIC_KEY}</symmetric-key>
            <allowed-origins-for-cors>https://admin.demo.example</allowed-origins-for-cors>
          </default-zone>
        </zones>
        <service-role>
          <id>default</id>
          <protocol>http</protocol>
          <webfinger/>
          <endpoints>applications</endpoints>
          <endpoints>authentication-service-anonymous</endpoints>
          <endpoints>authentication-service-authentication</endpoints>
          <endpoints>authentication-service-registration</endpoints>
          <endpoints>graphql-users-service</endpoints>
          <endpoints>token-service-anonymous</endpoints>
          <endpoints>token-service-assisted-token</endpoints>
          <endpoints>token-service-authorize</endpoints>
          <endpoints>token-service-introspect</endpoints>
          <endpoints>token-service-revoke</endpoints>
          <endpoints>token-service-session</endpoints>
          <endpoints>token-service-token</endpoints>
          <endpoints>token-service-userinfo</endpoints>
          <endpoints>user-service</endpoints>
        </service-role>
      </services>
    </environment>
  </environments>
  <facilities xmlns="https://curity.se/ns/conf/base">
    <http>
      <client>
        <id>internal_http_client</id>
        <tls>
          <use-truststore>true</use-truststore>
        </tls>
      </client>
    </http>
    <data-sources>
      <data-source>
        <id>default-datasource</id>
        <jdbc xmlns="https://curity.se/ns/ext-conf/jdbc">
          <connection-string>#{DB_CONNECTION}</connection-string>
          <standard-credentials-mode>
          </standard-credentials-mode>
          <driver>com.microsoft.sqlserver.jdbc.SQLServerDriver</driver>
          <password>#{DB_PASSWORD}</password>
          <username>#{DB_USER}</username>
        </jdbc>
      </data-source>
    </data-sources>
    <crypto>
      <ssl>
        <server-truststore>
          <server-certificate>
            <id>Training_Course_Local_CA</id>
            <curve-name>P-256</curve-name>
            <keystore>#{SSL_TRUST_STORE}</keystore>
            <type>elliptic-curve</type>
          </server-certificate>
        </server-truststore>
      </ssl>
      <signing-keys>
        <signing-key>
          <id>default-signing-key</id>
          <keystore>#{SIGNING_KEY}</keystore>
          <type>elliptic-curve</type>
          <curve-name>P-256</curve-name>
        </signing-key>
      </signing-keys>
      <signature-verification-keys>
      </signature-verification-keys>
    </crypto>
    <caching-services>
      <default-caching-service>
        <data-source>default-datasource</data-source>
      </default-caching-service>
    </caching-services>
    <email-providers>
      <email-provider>
        <id>smtp</id>
        <smtp>
          <smtp-host>smtpserver</smtp-host>
          <smtp-port>1025</smtp-port>
          <default-sender>noreply@maildev</default-sender>
          <username>noreply@maildev</username>
          <password>Password1</password>
        </smtp>
      </email-provider>
    </email-providers>
  </facilities>
  <processing xmlns="https://curity.se/ns/conf/base">
    <license-key>#{LICENSE_KEY}</license-key>
    <procedures>
      <transformation-procedure>
        <id>employee_set_subject_procedure</id>
        <script>LyoqCiAqIFRoaXMgaXMgYW4gZXhhbXBsZSBwcm9jZWR1cmUgdGhhdCBwZXJmb3JtcyBubyB0cmFuc2Zvcm1hdGlvbgogKiBAcGFyYW0ge3NlLmN1cml0eS5pZGVudGl0eXNlcnZlci5wcm9jZWR1cmVzLmNvbnRleHQuVHJhbnNmb3JtYXRpb25Qcm9jZWR1cmVDb250ZXh0fSBjb250ZXh0CiAqIEByZXR1cm5zIHsqfQogKi8KZnVuY3Rpb24gcmVzdWx0KGNvbnRleHQpIHsKICB2YXIgYXR0cmlidXRlcyA9IGNvbnRleHQuYXR0cmlidXRlTWFwOwogIAogIGlmIChhdHRyaWJ1dGVzLmVtYWlsKSB7CiAgICBhdHRyaWJ1dGVzLnN1YmplY3QgPSBhdHRyaWJ1dGVzLmVtYWlsOwogIH0KICBpZiAoYXR0cmlidXRlcy5ncm91cHMpIHsKICAgIGF0dHJpYnV0ZXMuZ3JvdXBzID0gWyJhZG1pbiJdOwogIH0KICByZXR1cm4gYXR0cmlidXRlczsKfQ==</script>
      </transformation-procedure>
      <transformation-procedure>
        <id>user_type_set_procedure</id>
        <script>LyoqCiAqIFRoaXMgaXMgYW4gZXhhbXBsZSBwcm9jZWR1cmUgdGhhdCBwZXJmb3JtcyBubyB0cmFuc2Zvcm1hdGlvbgogKiBAcGFyYW0ge3NlLmN1cml0eS5pZGVudGl0eXNlcnZlci5wcm9jZWR1cmVzLmNvbnRleHQuVHJhbnNmb3JtYXRpb25Qcm9jZWR1cmVDb250ZXh0fSBjb250ZXh0CiAqIEByZXR1cm5zIHsqfQogKi8KZnVuY3Rpb24gcmVzdWx0KGNvbnRleHQpIHsKICB2YXIgYXR0cmlidXRlcyA9IGNvbnRleHQuYXR0cmlidXRlTWFwOwogIGF0dHJpYnV0ZXMuaXNFbXBsb3llZSA9IGNvbnRleHQuc3ViamVjdEF0dHJpYnV0ZU1hcC5zdWJqZWN0LmluZGV4T2YoJ29ubWljcm9zb2Z0LmNvbScpICE9PSAtMTsKICByZXR1cm4gYXR0cmlidXRlczsKfQ==</script>
      </transformation-procedure>
      <transformation-procedure>
        <id>set_final_subject_procedure</id>
        <script>LyoqCiAqIFRoaXMgaXMgYW4gZXhhbXBsZSBwcm9jZWR1cmUgdGhhdCBwZXJmb3JtcyBubyB0cmFuc2Zvcm1hdGlvbgogKiBAcGFyYW0ge3NlLmN1cml0eS5pZGVudGl0eXNlcnZlci5wcm9jZWR1cmVzLmNvbnRleHQuVHJhbnNmb3JtYXRpb25Qcm9jZWR1cmVDb250ZXh0fSBjb250ZXh0CiAqIEByZXR1cm5zIHsqfQogKi8KZnVuY3Rpb24gcmVzdWx0KGNvbnRleHQpIHsKICB2YXIgYXR0cmlidXRlcyA9IGNvbnRleHQuYXR0cmlidXRlTWFwOwogIAogIHZhciBvdGhlckZhY3RvcnMgPSBbInN1YmplY3RAb3RoZXJfYXV0aG9yaXRpZXMiXTsKICBpZiAob3RoZXJGYWN0b3JzICYmIG90aGVyRmFjdG9ycy5sZW5ndGggPiAwICYmIG90aGVyRmFjdG9yc1swXS5zdWJqZWN0KSB7CiAgICAgIGF0dHJpYnV0ZXMuc3ViamVjdCA9IG90aGVyRmFjdG9yc1swXS5zdWJqZWN0OwogIH0KICAKICByZXR1cm4gYXR0cmlidXRlczsKfQ==</script>
      </transformation-procedure>
    </procedures>
    <account-managers>
      <account-manager>
        <id>default-account-manager</id>
        <username-is-email>true</username-is-email>
        <account-data-source>default-datasource</account-data-source>
      </account-manager>
    </account-managers>
    <credential-managers>
      <credential-manager>
        <id>default-credential-manager</id>
        <Sha2WithSha256>
        </Sha2WithSha256>
        <data-source-backed>
          <data-source-id>default-datasource</data-source-id>
        </data-source-backed>
      </credential-manager>
    </credential-managers>
  </processing>
  <nacm xmlns="urn:ietf:params:xml:ns:yang:ietf-netconf-acm">
    <write-default>permit</write-default>
    <groups>
      <group>
        <name>admin</name>
        <user-name>admin</user-name>
      </group>
    </groups>
    <rule-list>
      <name>dd-admin</name>
      <group>admin</group>
      <rule>
        <name>alarms</name>
        <path>/al:alarms</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-profile-id</name>
        <path>/profiles/profile/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-profile-type</name>
        <path>/profiles/profile/type</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-credential-manager-id</name>
        <path>/processing/credential-managers/credential-manager/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-signature-verification-key-id</name>
        <path>/facilities/crypto/signature-verification-keys/signature-verification-key/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-encryption-key-id</name>
        <path>/facilities/crypto/encryption-keys/encryption-key/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-http-client-id</name>
        <path>/facilities/http/client/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-android-policy-id</name>
        <path>/facilities/client-attestation/android-policy/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-web-policy-id</name>
        <path>/facilities/client-attestation/web-policy/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-ios-policy-id</name>
        <path>/facilities/client-attestation/ios-policy/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-template-areas</name>
        <path>/environments/environment/available-template-areas</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-consentor-id</name>
        <path>/profiles/profile/settings/as:authorization-server/consentors/consentor/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-claims</name>
        <path>/profiles/profile/settings/as:authorization-server/claims</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-custom-token-issuer-id</name>
        <path>/profiles/profile/token-issuers/custom-token-issuer/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-custom-token-issuer-purpose-type</name>
        <path>/profiles/profile/token-issuers/custom-token-issuer/purpose-type</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-associated-authentication-profile</name>
        <path>/profiles/profile/settings/as:authorization-server/authentication-service/authentication-profile</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-client-capabilities</name>
        <path>/profiles/profile/settings/as:authorization-server/client-capabilities</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-dynamic-client-registration-templatized</name>
        <path>/profiles/profile/settings/as:authorization-server/dynamic-client-registration/templatized</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-redirect-policies</name>
        <path>/profiles/profile/settings/as:authorization-server/redirect-uri-validation-policies</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-db-client-tags</name>
        <path>/profiles/profile/settings/as:authorization-server/database-client/client-tags/client-tag</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-authenticator-filter-id</name>
        <path>/profiles/profile/settings/auth:authentication-service/authenticator-filters/authenticator-filter/id</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-authenticators</name>
        <path>/profiles/profile/settings/auth:authentication-service/authenticators/authenticator</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>read-backchannel-authenticators</name>
        <path>/profiles/profile/settings/auth:authentication-service/authenticators/backchannel-authenticator</path>
        <access-operations>read</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>all-clients</name>
        <path>/profiles/profile/settings/as:authorization-server/as:client-store/as:config-backed/as:client</path>
        <access-operations>create read update delete</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>scopes</name>
        <path>/profiles/profile/settings/as:authorization-server/scopes</path>
        <access-operations>create read update delete</access-operations>
        <action>permit</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
      <rule>
        <name>deny-access</name>
        <action>deny</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
    </rule-list>
    <rule-list>
      <name>admin</name>
      <group>admin</group>
      <rule>
        <name>any-access</name>
        <action>permit</action>
      </rule>
    </rule-list>
    <rule-list>
      <name>any-dashboard</name>
      <group>*</group>
      <rule>
        <name>deny-all-dashboard-access</name>
        <path>/</path>
        <action>deny</action>
        <context xmlns="http://tail-f.com/yang/acm">rest</context>
      </rule>
    </rule-list>
    <rule-list>
      <name>any-group</name>
      <group>*</group>
      <rule>
        <name>tailf-aaa-authentication</name>
        <module-name>tailf-aaa</module-name>
        <path>/aaa/authentication/users/user[name='$USER']</path>
        <access-operations>read update</access-operations>
        <action>permit</action>
      </rule>
      <rule>
        <name>tailf-aaa-user</name>
        <module-name>tailf-aaa</module-name>
        <path>/user[name='$USER']</path>
        <access-operations>create read update delete</access-operations>
        <action>permit</action>
      </rule>
      <rule>
        <name>tailf-webui-user</name>
        <module-name>tailf-webui</module-name>
        <path>/webui/data-stores/user-profile[username='$USER']</path>
        <access-operations>create read update delete</access-operations>
        <action>permit</action>
      </rule>
    </rule-list>
  </nacm>
  <aaa xmlns="http://tail-f.com/ns/aaa/1.1">
    <authentication>
      <users>
        <user>
          <name>admin</name>
          <uid>0</uid>
          <gid>0</gid>
          <password>#{ADMIN_PASSWORD}</password>
          <ssh_keydir>/opt/idsvr/home/admin/.ssh</ssh_keydir>
          <homedir>/opt/idsvr/home/admin</homedir>
        </user>
      </users>
    </authentication>
    <ios>
      <level>
        <nr>0</nr>
        <prompt>\h> </prompt>
      </level>
      <level>
        <nr>15</nr>
        <prompt>\h# </prompt>
      </level>
      <privilege>
        <mode>exec</mode>
        <level>
          <nr>0</nr>
          <command>
            <name>action</name>
          </command>
          <command>
            <name>autowizard</name>
          </command>
          <command>
            <name>enable</name>
          </command>
          <command>
            <name>exit</name>
          </command>
          <command>
            <name>help</name>
          </command>
          <command>
            <name>startup</name>
          </command>
        </level>
        <level>
          <nr>15</nr>
          <command>
            <name>configure</name>
          </command>
        </level>
      </privilege>
    </ios>
  </aaa>
</config>